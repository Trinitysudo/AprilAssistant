<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Webcam Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            background-image: radial-gradient(circle at center, #1f2937 0%, #111827 70%);
        }
        @keyframes pulse-red {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 0 20px rgba(239, 68, 68, 0);
            }
        }
        .listening-animation {
            animation: pulse-red 2s infinite;
        }
        .custom-focus:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.5);
            border-color: #ef4444;
        }
        .video-container video, 
        .video-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .video-container {
            position: relative;
            border-radius: 1.5rem;
            overflow: hidden;
            background: #111827;
            padding: 3px;
        }
        .video-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 1.5rem;
            padding: 2px;
            background: linear-gradient(145deg, #4b5563, #1f2937);
            -webkit-mask: 
                linear-gradient(#fff 0 0) content-box, 
                linear-gradient(#fff 0 0);
            -webkit-mask-composite: destination-out;
            mask-composite: exclude;
        }
    </style>
</head>
<body class="text-white flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto flex flex-col items-center space-y-8">

        <!-- Webcam Feed Container -->
        <div class="w-full aspect-video rounded-3xl shadow-2xl video-container">
            <!-- Change video to img so Flask can stream /video_feed -->
            <img id="videoFeed" src="/video_feed" class="rounded-2xl" />
        </div>

        <!-- Listening Button -->
        <div class="relative flex items-center justify-center">
            <button id="listenButton" class="bg-gray-800 hover:bg-gray-700 transition-all duration-300 ease-in-out rounded-full w-24 h-24 flex items-center justify-center shadow-lg focus:outline-none custom-focus">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                    <line x1="12" y1="19" x2="12" y2="23"></line>
                    <line x1="8" y1="23" x2="16" y2="23"></line>
                </svg>
            </button>
            <div id="statusText" class="absolute -bottom-8 text-gray-500 text-sm transition-opacity duration-300 opacity-0">Listening...</div>
        </div>

        <!-- Text Input and Send Button -->
        <div class="w-full flex items-center space-x-3">
            <input type="text" id="textInput" placeholder="Or type your command..." class="flex-grow bg-gray-900 border border-gray-700 rounded-lg py-3 px-4 focus:border-red-500 custom-focus transition-colors duration-300">
            <button id="sendButton" class="bg-red-600 hover:bg-red-500 text-white font-semibold rounded-lg py-3 px-5 transition-colors duration-300 custom-focus">
                Send
            </button>
        </div>

    </div>

    <script>
        const listenButton = document.getElementById('listenButton');
        const statusText = document.getElementById('statusText');
        const textInput = document.getElementById('textInput');
        const sendButton = document.getElementById('sendButton');

        let isListening = false;

        listenButton.addEventListener('click', () => {
            isListening = !isListening;
            toggleListeningState(isListening);
        });

        sendButton.addEventListener('click', () => {
            const text = textInput.value;
            if (text) {
                console.log("Sending text:", text);
                textInput.value = '';
            }
        });

        textInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                sendButton.click();
            }
        });

        function toggleListeningState(shouldListen) {
            if (shouldListen) {
                listenButton.classList.add('listening-animation');
                listenButton.classList.remove('bg-gray-800');
                listenButton.classList.add('bg-red-600');
                statusText.classList.remove('opacity-0');
                console.log("AI is now listening...");
            } else {
                listenButton.classList.remove('listening-animation');
                listenButton.classList.remove('bg-red-600');
                listenButton.classList.add('bg-gray-800');
                statusText.classList.add('opacity-0');
                console.log("AI has stopped listening.");
            }
        }

        // Poll backend every 2s for status (wake word)
        async function pollStatus() {
            try {
                const res = await fetch('/status');
                const data = await res.json();
                if (data.listening) {
                    toggleListeningState(true);
                }
            } catch (err) {
                console.error("Status check failed:", err);
            }
            setTimeout(pollStatus, 2000);
        }
        pollStatus();
    </script>

</body>
</html>
